$.extend(spa.defaults.components,{rootPath:"app/components/",templateExt:".html",scriptExt:".min.js",callback:null});var _$=document.querySelector.bind(document),_$$=document.querySelectorAll.bind(document),appStorage={},app={api:{liveApiPrefix:"apiRoot/",errorHandle:{}},debug:!1,conf:{},settings:{},uiHelper:{},init:{},utils:{},storage:{},user:{storeName:"",displayName:""},activeGitLab:{apiUrl:"",pid:"",pName:"",pKey:"",uName:"",uId:"",web:""}};app.conf={issueSeverityLabels:"showstopper,critical,major,normal,minor,enhancement",issueStatusLabels:"Pending,Backlog,In-Progress,Fixing,Fixed,No-Fix,Works-For-Me,Duplicate,More-Info,Invalid-Issue,Done",issuePriorityLabels:"P1,P2,P3,P4,P5",issueLabelsGrp:{CRITICAL:"showstopper,critical",WARNING:"major"},flyoutTimeout:10,flyoutSort:"desc",dateDisplayFormat:"ddd, DD MMM YYYY hh:mm:ss",lang:{path:"app/language/",ext:".txt",cache:!0,async:!0,callback:function(){document.title=$("<span>"+spa.i18n.text("lbl.appName")+"</span>").text()}}},app.settings={setLang:function(n){_.isString(n)||(n=_.last(spa.urlHash([]))),n=n||"en_US";var a=n.split("_");$("#containerHeader").find("#langSelection").html(a[0].toUpperCase()+' <i class="dropdown '+a[1].toLowerCase()+' flag"></i>'),spa.i18n.setLanguage(n,app.conf.lang)},i18nSpan:function(n){return'<span data-i18n="'+n+'">'+spa.i18n.text(n)+"</span>"},dtLang:function(){var n=" -- "+app.settings.i18nSpan("dtLang.selected")+": %d",a=app.settings.i18nSpan("dtLang.sInfo.showing")+" _START_ "+app.settings.i18nSpan("dtLang.sInfo.to")+" _END_ "+app.settings.i18nSpan("dtLang.sInfo.of")+" _TOTAL_",t="("+app.settings.i18nSpan("dtLang.sInfo.filteredFrom")+" _MAX_ "+app.settings.i18nSpan("dtLang.sInfo.entries")+")";return{sEmptyTable:app.settings.i18nSpan("dtLang.sEmptyTable"),sInfoEmpty:app.settings.i18nSpan("dtLang.sInfoEmpty"),sZeroRecords:app.settings.i18nSpan("dtLang.sZeroRecords"),sInfo:a,sInfoFiltered:t,sLoadingRecords:app.settings.i18nSpan("dtLang.sLoadingRecords"),sProcessing:app.settings.i18nSpan("dtLang.sProcessing"),sSearch:app.settings.i18nSpan("dtLang.sSearch"),select:{rows:{0:"",1:n,_:n}}}}};

$.extend(spa.api,{isCallSuccess:function(){return!0},onReqError:function(r,e,a){app.uiHelper.enableIssueSearch(),app.api.errorHandle.hasOwnProperty(r.status)?app.api.errorHandle[r.status](r,e,a):app.api.errorHandle.Unknown(r,e,a)},onResError:function(){app.uiHelper.enableIssueSearch()}}),app.api.errorHandle["400"]=function(){app.uiHelper.showAlert("warning","alert.msg.req.error.400",function(){app.auth.clearSession()})},app.api.errorHandle["401"]=function(){app.uiHelper.showAlert("warning","alert.msg.req.error.401")},app.api.errorHandle["403"]=function(){app.uiHelper.showAlert("warning","alert.msg.req.error.403",function(){app.auth.clearSession()})},app.api.errorHandle["404"]=function(){app.uiHelper.showAlert("warning","alert.msg.req.error.404")},app.api.errorHandle["408"]=function(){app.uiHelper.showAlert("warning","alert.msg.req.error.408",function(){app.auth.clearSession()})};var lastFailedjqXHR;app.api.errorHandle.Unknown=function(r){lastFailedjqXHR=r,console.log("Inspect lastFailedjqXHR for more details."),app.uiHelper.showAlert("warning","alert.msg.req.error.Unknown")};

$.extend(spa.api.urls,{gitLabProfile:"apiRoot/user",gitLabProjects:"apiRoot/projects",gitLabProjMilestones:"apiRoot/projects/{pid}/milestones?per_page=100&page=1",gitLabProjLabels:"apiRoot/projects/{pid}/labels?per_page=100&page=1",gitLabProjectMembers:"apiRoot/projects/{pid}/members?per_page=100&page=1",gitLabIssues:"apiRoot/projects/{pid}/issues?per_page=100&page={pgN}&order_by=created_at&sort=asc",gitLabIssueNotes:"apiRoot/projects/{pid}/issues/{issueId}/notes?per_page=100&page=1",gitLabIssueNotesNew:"apiRoot/projects/{pid}/issues/{issueId}/notes",gitLabIssueDetails:"apiRoot/projects/{pid}/issues/{issueId}",gitLabIssueByIid:"apiRoot/projects/{pid}/issues?iid={issueId}",gitLabIssueAssignTo:"apiRoot/projects/{pid}/issues/{issueId}?assignee_id={mid}",gitLabIssueMilestone:"apiRoot/projects/{pid}/issues/{issueId}?milestone_id={msid}",gitLabIssueLabels:"apiRoot/projects/{pid}/issues/{issueId}?labels={lblNames}",gitLabIssueClose:"apiRoot/projects/{pid}/issues/{issueId}?state_event={newState}"});

app.utils.callFunction=function(a,e){"use strict";if(_.isString(a)){var i=spa.findSafe(window,a);_.isFunction(i)&&i.call(window,e)}},$.confirmDialog=function(a){"use strict";$.confirmClose(!0);var e,i,n=(a.type||a.confirmType||a.confirmtype).toLowerCase(),t=n.indexOf("loader")>=0?'<div class="loader"></div>':"",s=a.id||"confirmDlg_"+spa.now(),o=spa.i18n.text(a.title||"confirm.title."+n),r=spa.i18n.text(a.message||a.msg||a.m,spa.toJSON(a.data)),p="";$.each(a.buttons,function(a,n){e=n.id||"DlgBtn_"+a.replace(/[^a-zA-Z0-9]/g,""),i=spa.i18n.text(n.i18n||"common.dialog.btn."+a),p+='<button class="ui button primary" id="'+e+'">'+i+"</button>"});var l=['<div class="ui dimmer dialogbox visible active" id="',s,'">','<div class="ui small modal visible active">','<div class="header center"><i class="stl-icons ',n,'"></i><span>',o,"</span></div>",'<div class="content center"><div class="cicons ',n,'"></div>',r,"</div>",t,'<div class="actions center ',a.buttonstatus||a.buttonStatus||"show",'">',p,"</div></div></div>"].join("");$(l).hide().appendTo("body").fadeIn();var c=$(".ui.dialogbox .button").filter(":visible"),u=0;$.each(a.buttons,function(e,i){$(c.eq(u++)).off("click").on("click",function(){return i.action&&i.action(a.data),$.confirmClose(),!1})}),spa.setFocus($(".ui.dialogbox .button").filter(":visible")[a.defaultBtn||0])},$.confirmClose=function(a){"use strict";var e=$(".ui.dimmer.dialogbox");a?e.remove():e.fadeOut(function(){$(this).remove()})},app.uiHelper.indicateLoading=function(a,e){$(a).each(function(a,i){$(i)[e+"Class"]("loading")})},app.uiHelper.enableIssueSearch=function(){$("#issueSearchTxt").prop("readonly",!1),app.uiHelper.indicateLoading("#btnIssueSearch","remove")},app.uiHelper.activateTab=function(a,e){var i=$(a);i.find(".ui.menu .item, .ui.tab").removeClass("active"),i.find('[data-tab="'+e+'"]').addClass("active")},app.uiHelper.utcToLocal=function(a){return spa.isBlank(a)?"-":moment.utc(a).local().format(app.conf.dateDisplayFormat)},app.uiHelper.webHelper=function(){var a=$(".container-component[data-help]:visible").data("help"),e=app.conf.webHelpUri+(a?"?topic="+a:"");$("#helpLauncher").attr("href",e)[0].click()},app.uiHelper.updateGitLabImageSrc=function(a){var e='<br/><a target="_blank" href="'+(app.activeGitLab.web||"")+'$2" title="Click to see original size image"><i class="icon image"/> $1<br/><img class="img-screenshot-thumb" src="'+(app.activeGitLab.web||"")+'$2" alt="$1"/></a><br/>',i='<br/><a target="_blank" href="'+(app.activeGitLab.web||"")+'$2" title="Click to download"><i class="icon attach"></i> $1</a><br/>',n=(a||"").replace(/\n/g,"<br/>").replace(/\r/g,"").replace(/\!\[(.*?)\]\((.*?)\)/g,e).replace(/\[(.*?)\]\((.*?)\)/g,i);return n},app.uiHelper.openInNewTab=function(a){$("#xLinkLauncher").attr("href",a)[0].click()},app.uiHelper.setBackground=function(){"use strict";$("body").addClass("bg-image"),$(".authBlock").addClass("hide")},app.uiHelper.unsetBackground=function(){"use strict";$("body").removeClass("bg-image"),$(".authBlock").removeClass("hide"),$("#userDisplayName").html(app.user.displayName)},app.uiHelper.clearSignInServerErrorMsg=function(){return app.uiHelper.clearSSErrorMsg("#containersignIn"),!0},app.uiHelper.clearSSErrorMsg=function(a){var e=$(a),i=e.find(".SS-ERR-MSG");return i.html(""),i.closest(".message").addClass("hide"),!0},app.uiHelper.showSSErrorMsg=function(a,e){var i=$(a),n=i.find(".SS-ERR-MSG");return n.i18n(e),n.closest(".message").removeClass("hide"),!0},app.uiHelper.showAlert=function(a,e,i,n){"use strict";"string|object".containsStr(typeof i)&&(n=arguments[2],i=arguments[3]),$.confirmDialog({title:a.toProperCase(),message:e,type:a,data:n,buttons:{Ok:{action:function(a){i&&i(a)}}}})},app.uiHelper.closeModal=function(a){$(a||".ui.modal:visible").modal("hide").modal("hide dimmer")},app.uiHelper.flyout=function(a,e,i,n){"use strict";"string|object".containsStr(typeof i)&&(n=arguments[2],i=arguments[3]),i===void 0&&(i=app.conf.flyoutTimeout);var t=spa.i18n.text(e,spa.toJSON(n)),s={asc:"append",desc:"prepend"},o=new Date,r="fo_"+spa.now()+"_"+spa.rand(1e3,9999),p=$(".flyout"),l='<div class="flyout-wrap" id="'+r+'"><div class="flyout-box '+a+'">'+'<div class="flyout-header"><span>'+o.yyyymmdd("-")+" "+o.hhmmss(":")+'</span><div class="close">X</div></div>'+'<div class="content">'+t+"</div></div></div>";spa.isElementExist(".flyout-control")||p.append('<div class="flyout-control" title="Notifications">5</div>'),p[s[app.conf.flyoutSort]](l),i&&setTimeout(function(){$("#"+r).fadeOut(500)},1e3*i),$(".flyout-control").html(p.find(".flyout-wrap").length)},$(document).on("click",".flyout .close",function(){"use strict";$(this).closest(".flyout-wrap").fadeOut(500).remove();var a=$(".flyout");a.find(".flyout-wrap").length||a.find(".flyout-control").remove(),$(".flyout-control").html(a.find(".flyout-wrap").length)}),$(document).on("click",".flyout-control",function(){"use strict";var a=$(".flyout .flyout-wrap");a.find(":visible").length?a.fadeOut(500):a.fadeIn(500)}),app.uiHelper.disableBtns=function(a,e){var i=$(a);return i.each(function(a,i){$(i).prop("disabled",!0).find("i.icon").addClass(e?"loading":"")}),i},app.uiHelper.enableBtns=function(a){var e=$(a);return e.each(function(a,e){$(e).prop("disabled",!1).find("i.icon").removeClass("loading")}),e},spa.module("auth",{signUp:function(){"use strict";if(spa.isBlank(spa.validate("#fm_signIn",!0))){app.uiHelper.clearSSErrorMsg("#containersignIn"),app.uiHelper.disableBtns("#fm_signIn #signUpButton",!0);var a=$("#fm_signIn #userName"),e=$("#fm_signIn #userPwd"),i=a.val(),n=e.val();appStorage.hasOwnProperty(i)?app.auth.onSignInFail({i18nKey:"err.signIn.usrNameAlreadyFound"}):(appStorage[i]={key:Sha256.hash(n)},app.init.updateAppStorage(),app.uiHelper.enableBtns("#fm_signIn #signInButton, #fm_signIn #signUpButton"),app.auth.signIn())}},signIn:function(){"use strict";if(spa.isBlank(spa.validate("#fm_signIn",!0))){app.uiHelper.clearSSErrorMsg("#containersignIn"),app.uiHelper.disableBtns("#fm_signIn #signInButton",!0);var a=$("#fm_signIn #userName"),e=$("#fm_signIn #userPwd"),i=a.val(),n=e.val();appStorage.hasOwnProperty(i)?Sha256.hash(n)===appStorage[i].key?(a.val(""),e.val(""),appStorage.lastSignIn=spa.now(),appStorage.defaultUsr=$("#fm_signIn #rememberMe").is(":checked")?i:"",app.init.updateAppStorage(),app.auth.onSignInSuccess({usrName:i,usrPwd:n})):app.auth.onSignInFail({i18nKey:"err.signIn.incorrectPwd"}):app.auth.onSignInFail({i18nKey:"err.signIn.usrNameNotFound"})}},onSignInSuccess:function(a){"use strict";app.uiHelper.enableBtns("#fm_signIn #signInButton, #fm_signIn #signUpButton"),app.user.storeName=spa.findSafe(a,"usrName","Guest"),app.user.displayName=spa.findSafe(a,"usrName","Guest"),app.user._=sjcl.encrypt(appStorage.lastSignIn,spa.findSafe(a,"usrPwd",""));var e=appStorage[app.user.storeName],i=e.connections;if(!spa.isBlank(i)){var n=i.defaultConnection;spa.isBlank(n)&&(n=Object.keys(i)[0],i.defaultConnection=n,app.init.updateAppStorage());var t=i[n];app.activeGitLab.apiUrl=t.url||"",app.activeGitLab.pid=t.pid||"",app.activeGitLab.pKey=t.key?sjcl.decrypt(sjcl.decrypt(appStorage.lastSignIn,app.user._),t.key):"",app.activeGitLab.uName=t.uname||"",app.activeGitLab.uId=t.uid||"",app.activeGitLab.web=t.web||"",app.activeGitLab.pName=t.pName||""}app.uiHelper.unsetBackground(),app.init.usrHome()},onSignInFail:function(a){"use strict";app.uiHelper.enableBtns("#fm_signIn #signInButton, #fm_signIn #signUpButton"),app.uiHelper.showSSErrorMsg("#containersignIn",a.i18nKey)},signOut:function(){"use strict";app.auth.clearSession()},clearSession:function(){"use strict";app.user={},app.activeGitLab={},app.uiHelper.closeModal(),document.location.reload()}});

app.init.ajax=function(){"use strict";$.ajaxPrefilter(function(t){t.url.beginsWithStr(spa.api.urlKeyIndicator)&&(t.url=spa.api.url(t.url.trimLeftStr(spa.api.urlKeyIndicator),t.data));var i=t.url;i.beginsWithStr(app.api.liveApiPrefix)&&(t.beforeSend=function(t){t.setRequestHeader("PRIVATE-TOKEN",app.activeGitLab.pKey)}),t.hasOwnProperty("error")||(t.error=spa.api.onReqError),spa.api.mock||i.beginsWithStr("!")?(t.type="GET",i=i.trimLeftStr("!"),i.beginsWithStr(app.api.liveApiPrefix)&&(i.containsStr("\\?")||(i=i.trimRightStr("/")+"?"),t.url=i.replace(RegExp(app.api.liveApiPrefix),"api_/").replace(/\?/,"/data.json?"),app.debug&&console.warn(">>>>>>Intercepting Live API URL: ["+i+"] ==> ["+t.url+"]"))):t.url=i.replace(RegExp(app.api.liveApiPrefix),app.activeGitLab.apiUrl)})},app.init.updateAppStorage=function(){store.set("krGlit",appStorage)},app.init.appStorage=function(){appStorage=store.get("krGlit"),spa.isBlank(appStorage)&&(appStorage={})},app.storage.getDefaultConnection=function(){var t=appStorage[app.user.storeName],i=t.defaultConnection,e=t.connections;return e[i]},app.storage.getDefaultConnectionSetting=function(t){return app.storage.getDefaultConnection()[t]},app.storage.updateDefaultConnectionSettings=function(t){var i=app.storage.getDefaultConnection();_.merge(i,t),app.init.updateAppStorage()},app.storage.getConnectionDetails=function(t){var i=appStorage[app.user.storeName],e=i.connections,a={};if(!spa.isBlank(e)){var n=t||e.defaultConnection;spa.isBlank(n)&&(n=Object.keys(e)[0]),a=e[n],a.conName=n}return a},app.init.app=function(){app.init.appStorage(),app.init.ajax(),app.settings.setLang("en_US"),app.init.usrHome()},app.init.dropDowns=function(t){"use strict";$(t).find(".menu .ui.dropdown").dropdown({on:"click"}),$(t).find(".menu a.item, .vertical .menu .item").filter(":not(.passive)").on("click",function(){$(this).addClass("active").siblings().removeClass("active")})},app.init.radioTabs=function(t){"use strict";$(t).find(".radiotab").on("click",function(){var t=$(this),i=t.data("tabTarget");app.utils.callFunction(t.data("tabBefore"),t),t.closest(".radiotabs").children(".ui.tab").removeClass("active"),$(i).addClass("active"),app.utils.callFunction(t.data("tabAfter"),t),$("#popup1, #popup2, #popup3").modal("refresh")}),$(t).find(".ui.radio.checkbox").checkbox()},app.init.checkboxs=function(t){"use strict";var i=$(t).find(".ui.checkbox");spa.isBlank(i)&&(i=$(t).filter(".ui.checkbox")),i.checkbox()},app.init.selects=function(t){"use strict";var i=$(t).find("select");spa.isBlank(i)&&(i=$(t).filter("select")),i.dropdown({showOnFocus:!1})},app.init.formElements=function(t){"use strict";app.init.checkboxs(t),app.init.selects(t)},app.init.accordions=function(t){"use strict";$(t).find(".ui.accordion").accordion(),$(t).find(".accordion .menu .item a").on("click",function(){$(t).find(".accordion .menu .item").removeClass("active"),$(this).addClass("active")})},app.init.tabs=function(t){"use strict";$(t).find(".menu .item").tab()},app.init.usrHome=function(){if(app.user.storeName){var t="settings";app.activeGitLab.pid&&!spa.isBlank(app.storage.getDefaultConnectionSetting("members"))&&(t="issues"),spa.renderComponents(t)}else spa.renderComponents("signIn")},$(document).ready(function(){"use strict";app.init.app()}),$(window).resize(function(){"use strict";dt.resizeTableHeight()});

Handlebars.registerHelper("toLowerCase",function(e){return(e||"").toLowerCase()}),Handlebars.registerHelper("toNumber",function(e){return spa.toInt(e||"")}),Handlebars.registerHelper("toDecimal",function(e){return spa.toFloat(e||"")}),Handlebars.registerHelper("utcToLocal",function(e){return app.uiHelper.utcToLocal(e)}),Handlebars.registerHelper("toHtml",function(e){return(e||"").replace(/\n/g,"<br/>")}),Handlebars.registerHelper("updateMediaLinks",function(e){return app.uiHelper.updateGitLabImageSrc(e||"")}),Handlebars.registerHelper("toIssueSeverity",function(e){return _.filter(e,function(e){return app.conf.issueSeverityLabels.containsStrIgnoreCase(e)}).join("<br/>")}),Handlebars.registerHelper("toIssueStatus",function(e){return _.filter(e,function(e){return app.conf.issueStatusLabels.containsStrIgnoreCase(e)}).join("<br/>")}),Handlebars.registerHelper("compare",function(e,r,n,t){var o,a;if(3>arguments.length)throw Error("Handlerbars Helper 'compare' needs 2 parameters");if(void 0===t&&(t=n,n=r,r="==="),o={"==":function(e,r){return e===r},"===":function(e,r){return e===r},"!=":function(e,r){return e!==r},"!==":function(e,r){return e!==r},"<":function(e,r){return r>e},">":function(e,r){return e>r},"<=":function(e,r){return r>=e},">=":function(e,r){return e>=r},"typeof":function(e,r){return typeof e===r}},!o[r])throw Error("Handlerbars Helper 'compare' doesn't know the operator "+r);return a=o[r](e,n),a?t.fn(this):t.inverse(this)});

