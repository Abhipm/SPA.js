spa.component("gitLabIssue",{target:"#gitLabIssue"}),spa.extendComponent("gitLabIssue",{data:{},renderCallback:function(e){app.uiHelper.indicateLoading("#btnIssueFullRefresh","add");var s=e.model;app.gitLabIssue.data=s,spa.optionsLoad("#assignToNewMember",app.gitLabIssues.prjMembers,1,2),app.gitLabIssue.resetAssignTo(),spa.optionsLoad("#issueMilestone",app.gitLabIssues.prjMilestones,1,2),app.gitLabIssue.resetMilestone(),spa.optionsLoad("#issueLabels",app.gitLabIssues.prjLabels,1,2),app.gitLabIssue.resetLabels(),app.init.selects("#containerGitLabIssue"),app.gitLabIssue.listNotes(),app.init.accordions("#containerGitLabIssue"),app.init.checkboxs("#containerGitLabIssue"),app.uiHelper.indicateLoading("#btnIssueFullRefresh","remove")},resetMilestone:function(){var e=spa.findSafe(app.gitLabIssue.data,"milestone.id","0");spa.selectOptionForValue("#issueMilestone",e),$("#issueMilestone").dropdown("set selected",e)},resetAssignTo:function(){var e=spa.findSafe(app.gitLabIssue.data,"assignee.id","0");spa.selectOptionForValue("#assignToNewMember",e),$("#assignToNewMember").dropdown("set selected",e)},resetLabels:function(){var e=spa.findSafe(app.gitLabIssue.data,"labels","0");spa.isBlank(e)&&(e=["0"]),spa.selectOptionsForValues("#issueLabels",e.join(",")),$("#issueLabels").dropdown("set selected",e)},clearLabels:function(){var e=$("#issueLabels").closest(".ui.dropdown.selection");e.find("a.ui.label[data-value!=0]").each(function(e,s){$(s).find("i.delete.icon")[0].click()}),setTimeout(function(){app.gitLabIssue.updateLabels()},100)},updateLblSelection:function(){var e=spa.optionsSelectedValues("#issueLabels"),s=$("#issueLabels").closest(".ui.dropdown.selection");if(spa.isBlank(e))setTimeout(function(){s.find(".item[data-value=0]")[0].click()},100);else if(e.length>1){var a=$(s.find("a.ui.label[data-value]")[0]);"0"==a.data("value")?a.find("i.delete.icon")[0].click():setTimeout(function(){var e=s.find("a.ui.label[data-value=0]");e.length&&s.find("a.ui.label[data-value!=0]").each(function(e,s){$(s).find("i.delete.icon")[0].click()})},100)}},assignTo:function(){var e=spa.optionsSelectedValues("#assignToNewMember");e&&$.confirmDialog({title:"Confirm",message:"msg.confirm.assignTo",type:"Informational",data:{iid:app.gitLabIssue.data.id,name:spa.optionsSelectedTexts("#assignToNewMember")},buttons:{yes:{i18n:"lbl.btn.yes.assignTo",action:function(){app.gitLabIssue.assignToX(e)}},no:{i18n:"lbl.btn.no.assignTo",action:function(){app.gitLabIssue.resetAssignTo()}}}})},updateMilestone:function(){var e=app.gitLabIssue.data.id,s=spa.optionsSelectedValues("#issueMilestone");e&&("0".equalsIgnoreCase(s)&&(s=""),app.uiHelper.indicateLoading("#btnIssueFullRefresh","add"),spa.api.put(spa.api.url("@gitLabIssueMilestone",{pid:app.activeGitLab.pid,issueId:e,msid:s}),function(e){app.uiHelper.indicateLoading("#btnIssueFullRefresh","remove"),app.uiHelper.flyout("success","msg.flyout.issue.milestoneupdate",void 0,{iid:e.id||"?",milestone:spa.findSafe(e,"milestone.title","-None-")}),app.gitLabIssues.updateIssueDetailsInRowData(e),app.gitLabIssue.listNotes()}))},updateLabels:function(){var e=app.gitLabIssue.data.id,s=spa.optionsSelectedValues("#issueLabels");e&&("0".equalsIgnoreCase(s)&&(s=""),app.uiHelper.indicateLoading("#btnSaveLabels","add"),spa.api.put(spa.api.url("@gitLabIssueLabels",{pid:app.activeGitLab.pid,issueId:e,lblNames:s}),function(e){app.uiHelper.indicateLoading("#btnSaveLabels","remove"),app.uiHelper.flyout("success","msg.flyout.issue.labelsupdate",void 0,{iid:e.id||"?",milestone:spa.findSafe(e,"milestone.title","?")}),app.gitLabIssues.updateIssueDetailsInRowData(e),app.gitLabIssue.listNotes()}))},assignToMe:function(){spa.selectOptionForValue("#assignToNewMember",app.activeGitLab.uId),$("#assignToNewMember").dropdown("set selected",app.activeGitLab.uId),app.gitLabIssue.assignTo()},assignToX:function(e){var s=app.gitLabIssue.data.id;s&&("0".equalsIgnoreCase(e)&&(e=""),app.uiHelper.indicateLoading("#btnIssueFullRefresh","add"),spa.api.put(spa.api.url("@gitLabIssueAssignTo",{pid:app.activeGitLab.pid,issueId:s,mid:e}),function(e){app.uiHelper.indicateLoading("#btnIssueFullRefresh","remove"),app.uiHelper.flyout("success","msg.flyout.issue.assignedToX",void 0,{iid:e.id||"?",name:spa.findSafe(e,"assignee.name","-None-")}),app.gitLabIssues.updateIssueDetailsInRowData(e),app.gitLabIssue.listNotes()}))},listNotes:function(){var e=app.gitLabIssue.data.id;e&&(app.uiHelper.indicateLoading("#btnCommentsFullRefresh","add"),spa.api.get(spa.api.url("@gitLabIssueNotes",{pid:app.activeGitLab.pid,issueId:e}),function(e){app.uiHelper.indicateLoading("#btnCommentsFullRefresh","add"),spa.renderComponent("issueNotes",{data:{iNotes:e}})}))},clearPostForm:function(){$("#issueNewNoteBody").val(""),$("#closeIssue").prop("checked",!1)},closeReopenIssueX:function(e){if(e){var s="closed".equalsIgnoreCase(app.gitLabIssue.data.state)?"reopen":"close";app.uiHelper.indicateLoading("#btnIssueFullRefresh","add"),spa.api.put(spa.api.url("@gitLabIssueClose",{pid:app.activeGitLab.pid,issueId:e,newState:s}),function(e){app.uiHelper.indicateLoading("#btnIssueFullRefresh","remove"),app.uiHelper.flyout("success","msg.flyout.issue."+e.state,void 0,{iid:e.id||"?"}),app.gitLabIssues.updateIssueDetailsInRowData(e),app.gitLabIssue.refresh()})}},closeIssueConfirm:function(){var e=app.gitLabIssue.data.id,s="msg.confirm.issue.action.state."+app.gitLabIssue.data.state;e&&$.confirmDialog({title:"Confirm",message:s,type:"Warning",data:{iid:app.gitLabIssue.data.id},buttons:{yes:{i18n:s+".yes",action:function(){app.gitLabIssue.postNewNote(!0)}},no:{i18n:s+".no",action:function(){app.gitLabIssue.clearPostForm()}}}})},postNewNote:function(e){var s=app.gitLabIssue.data.id,a=($("#issueNewNoteBody").val()||"").trimStr();s&&(a?$("#closeIssue").is(":checked")&&!e?app.gitLabIssue.closeIssueConfirm():(app.uiHelper.indicateLoading("#btnIssuePost","add"),spa.api.post(spa.api.url("@gitLabIssueNotesNew",{pid:app.activeGitLab.pid,issueId:s}),{body:a},function(){app.uiHelper.indicateLoading("#btnIssuePost","remove"),$("#issueNewNoteBody").val(""),app.uiHelper.flyout("success","msg.flyout.issue.notePosted"),app.gitLabIssue.listNotes(),$("#closeIssue").is(":checked")&&app.gitLabIssue.closeReopenIssueX(s)})):app.uiHelper.showAlert("warning","validation.alert.issue.note.blank"))},refresh:function(){var e=app.gitLabIssue.data.id;e&&(app.uiHelper.indicateLoading("#btnIssueFullRefresh","add"),spa.api.get(spa.api.url("@gitLabIssueDetails",{pid:app.activeGitLab.pid,issueId:e}),function(e){app.gitLabIssues.updateIssueDetailsInRowData(e),e.description=app.uiHelper.updateGitLabImageSrc(e.description),spa.renderComponent("gitLabIssue",{data:e})}))}});