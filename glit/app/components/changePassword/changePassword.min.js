spa.component("changePassword",{target:"#popup2",data:app.user}),spa.extendComponent("changePassword",{renderCallback:function(){$("#popup2").modal("setting",{autofocus:!0,closable:!1,transition:"fade up",allowMultiple:!0}).modal("show").addClass("small")},save:function(){var a=spa.serialize("#containerChangePassword");a.NewPassword.equals(a.ConfirmPassword)?spa.isBlank(spa.validate("#fm_changePassword",!0))&&(app.changePassword.disableBtns(),$("#containerChangePassword #cancelButton").attr("disabled"),app.changePassword.change(a)):app.uiHelper.showAlert("warning","validation.alert.password.nomatch")},change:function(a){var e=a.UserName,s=a.NewPassword,n=Sha256.hash(s);if(appStorage.hasOwnProperty(e))if(Sha256.hash(a.CurrentPassword)===appStorage[e].key){var o=appStorage[app.user.storeName];if(o.hasOwnProperty("connections")){var r=o.defaultConnection||"";if(r&&o.connections.hasOwnProperty(r)){var t=sjcl.decrypt(sjcl.decrypt(appStorage.lastSignIn,app.user._),o.connections[r].key),p=sjcl.encrypt(s,t);o.connections[r].key=p}}app.user._=sjcl.encrypt(appStorage.lastSignIn,s),appStorage[e].key=n,app.init.updateAppStorage(),app.changePassword.onSuccess()}else app.uiHelper.showAlert("warning","err.signIn.incorrectPwd",function(){app.changePassword.enableBts()});else app.uiHelper.showAlert("warning","err.signIn.usrNameNotFound",function(){app.changePassword.enableBts()})},disableBtns:function(){$("#containerChangePassword #okButton").addClass("loading").attr("disabled")},enableBts:function(){$("#containerChangePassword").find("#okButton, #cancelButton").removeClass("loading").removeAttr("disabled")},onSuccess:function(){app.uiHelper.flyout("success","Password has been successfully changed."),app.changePassword.enableBts(),$("#containerChangePassword").find("#currentPassword, #newPassword, #confirmPassword").val(""),app.uiHelper.closeModal("#popup2")}});