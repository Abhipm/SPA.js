spa.component("gitLabIssues",{target:"#tabContainer_gitLabIssues"}),spa.extendComponent("gitLabIssues",{controlActionButtonsEnabled:!1,tableSelector:"#gitLabIssues",sourceData:[],apiStatus_List:"",jqXHR_List:void 0,cCount:0,wCount:0,prjMilestones:{},prjMembers:{},prjLabels:{},prjLblColor:{},lastClickedIssueId:"",inViewIssueId:"",ajaxTimer:new Timer,timerContainer:void 0,progressMsgContainer:void 0,toListLayoutIcon:"list",renderCallback:function(){"use strict";$("#container_gitLabIssues").addClass("hide"),app.gitLabIssues.prjMilestones=app.storage.getDefaultConnectionSetting("milestonesDD"),app.gitLabIssues.prjMembers=app.storage.getDefaultConnectionSetting("membersDD"),app.gitLabIssues.prjLabels=app.storage.getDefaultConnectionSetting("labelsDD"),app.gitLabIssues.prjLblColor=app.storage.getDefaultConnectionSetting("labelsColor"),$("#container_gitLabIssues .dropdown").dropdown(),app.gitLabIssues.buildDataTable(),app.gitLabIssues.progressMsgContainer=$("#container_gitLabIssues #progressMsg"),app.gitLabIssues.timerContainer=$("#container_gitLabIssues #containerTimer"),app.gitLabIssues.ajaxTimer.addEventListener("secondsUpdated",function(){app.gitLabIssues.timerContainer.html(app.gitLabIssues.ajaxTimer.getTimeValues().toString(["minutes","seconds","secondTenths"]))})},pullIssues:function(e,t){$('[data-table-id="gitLabIssues"]').prop("disabled",!0).find("i.icon").addClass("loading"),app.uiHelper.indicateLoading("#btnIssuesFullRefresh, #btnIssuesFullRefreshLink","add");try{app.gitLabIssues.ajaxTimer.isRunning()||(app.uiHelper.indicateLoading("#iconTimer","add"),app.gitLabIssues.ajaxTimer.start({precision:"secondTenths",callback:function(e){app.gitLabIssues.timerContainer.html(e.toString(["minutes","seconds","secondTenths"]))}}))}catch(s){}spa.api.get(spa.api.url("@gitLabIssues",{pid:app.activeGitLab.pid,pgN:e||1}),t,function(s,a,i){_.each(s,function(e){app.gitLabIssues.sourceData.push(e)}),i.getAllResponseHeaders().containsStr('rel="next"')?($("#container_gitLabIssues #progressMsg").html("Received "+app.gitLabIssues.sourceData.length+" issues. Receiving more ... "),app.gitLabIssues.loadData(),app.gitLabIssues.pullIssues(e+1,t)):($("#container_gitLabIssues #progressMsg").html("Received "+app.gitLabIssues.sourceData.length+" issues."),app.gitLabIssues.loadData(),app.gitLabIssues.ajaxTimer.stop(),app.uiHelper.indicateLoading("#iconTimer","remove"))})},loadData:function(){app.gitLabIssues.cCount=0,app.gitLabIssues.wCount=0;var e=app.gitLabIssues.sourceData,t=app.gitLabIssues.tableSelector,s=dt.tableKey(t),a=dt.tableId(t);if(dt.tables.hasOwnProperty(s)){var i=dt.tables[s];i.clear(),i.rows.add(e).draw(),dt.registerExport(a),$('[data-table-id="'+s+'"]').prop("disabled",!1).find("i.icon").removeClass("loading"),app.uiHelper.indicateLoading("#btnIssuesFullRefresh, #btnIssuesFullRefreshLink","remove"),app.gitLabIssues.updateSeverityCounts()}else app.gitLabIssues.buildDataTable()},list:function(e){"use strict";var t={},s=spa.radioSelectedValue("#fmIssuesFilter","issuesFilter");s&&(t.state=s);var a=spa.optionsSelectedTexts("#activeMilestone");"-All-".equalsIgnoreCase(a)||(t.milestone=a),$('[data-table-id="gitLabIssues"]').prop("disabled",!0).find("i.icon").addClass("loading"),app.uiHelper.indicateLoading("#btnIssuesFullRefresh, #btnIssuesFullRefreshLink","add"),e?(app.gitLabIssues.sourceData=[],$("#container_gitLabIssues #progressMsg").html("Receiving ... "),app.gitLabIssues.pullIssues(1,t)):app.gitLabIssues.loadData()},toLabelTags:function(e){return _.map(e,function(e){return'<span style="background:'+app.gitLabIssues.prjLblColor[e]+'">'+e+"</span>"})},buildDataTable:function(){app.uiHelper.indicateLoading("#btnIssuesFullRefresh, #btnIssuesFullRefreshLink","add");var e=app.gitLabIssues.tableSelector,t=dt.tableKey(e);if(dt.tables.hasOwnProperty(t)){var s=dt.tables[t];s.clear(),delete dt.tables[t]}$(e).html(""),dt.DataTable(e,{data:app.gitLabIssues.sourceData,scrollY:$("#mainContent").height()-250,columnDefs:[{targets:[0],orderable:!1,searchable:!1},{targets:[4],orderData:[9]},{targets:[9],visible:!1}],colVis:{exclude:[0,1,3,5,9]},aaSorting:[[4,"desc"]],"export":{iid:"IssueId",state:"State",id:"Severity",user_notes_count:"Status",labels:"Labels",author:"Author",project_id:"AssignedTo",created_at:"CreatedAt",updated_at:"UpdatedAt",milestone:"Milestone",upvotes:"Priority",title:"Title"},exportFormat:{id:function(e,t){return _.filter(t.labels,function(e){return app.conf.issueSeverityLabels.containsStrIgnoreCase(e)}).join(",")},user_notes_count:function(e,t){return _.filter(t.labels,function(e){return app.conf.issueStatusLabels.containsStrIgnoreCase(e)}).join(",")},author:function(e){return e.name||"Unknown"},project_id:function(e,t){var s=t.assignee||{name:"None"};return s.name||"None"},milestone:function(e){return spa.findSafe(e,"title","-")},upvotes:function(e,t){return _.filter(t.labels,function(e){return app.conf.issuePriorityLabels.containsStrIgnoreCase(e)}).join(",")}},createdRow:function(t,s,a){s._dtRowId=a;var i=$(t);i.data("rowData",s).attr("data-row-id",a).attr("data-issue-id",s.id);var n=_.filter(s.labels,function(e){return app.conf.issueSeverityLabels.containsStrIgnoreCase(e)});_.each(n,function(e){app.conf.issueLabelsGrp.CRITICAL.containsStrIgnoreCase(e)&&app.gitLabIssues.cCount++,app.conf.issueLabelsGrp.WARNING.containsStrIgnoreCase(e)&&app.gitLabIssues.wCount++}),i.on("click",function(){var t=$(this),s=(t.data("rowData"),t.data("rowId")),a=t.closest("tbody").find(":checkbox"),i=a.filter(":checked"),n=i.length>0,o=t.find(":checkbox");n?o.trigger("click"):(t.siblings().removeClass("selected"),t.addClass("selected"),dt.updateRowSelection(e),app.gitLabIssues.controlActionButtons(e),app.gitLabIssues.showDetails(s))}),i.find(":checkbox").on("click",function(t){var s=($(this),$(e+"_wrapper tbody").find(":checkbox:checked").closest("tr")),a=$(e+"_wrapper tbody").find(":checkbox:not(:checked)").closest("tr"),i=(s.length>0,_.map(a,function(e){return $(e).data("rowId")})),n=_.map(s,function(e){return $(e).data("rowId")}),o=dt.tables[dt.tableKey(e)];a.removeClass("selected"),s.addClass("selected"),spa.isBlank(i)||o.rows(i).deselect(),spa.isBlank(n)||o.rows(n).select(!0),app.gitLabIssues.controlActionButtons(e),1==s.length&&app.gitLabIssues.showDetails(s.data("rowId")),t.stopPropagation()})},columns:[{width:"15",title:'<input type="checkbox" class="CHECK-ALL-NONE" onclick="dt.selectAllNone(\''+e+"', this);app.gitLabIssues.controlActionButtons('"+e+"');\"/>",data:"id",render:function(e){var t='<input type="checkbox" class="ISSUE-CHECK" data-serialize-context="ISSUE-CHECK" name="selectedIssuesList" value="'+e+'" />';return t}},{width:"70",title:'<span data-i18n="tbl.col.title.issue.Severity"></span>',data:"labels","class":"issues labels-all",render:function(e){var t=_.filter(e,function(e){return app.conf.issueSeverityLabels.containsStrIgnoreCase(e)});return app.gitLabIssues.toLabelTags(t).join("<br/>")}},{width:"70",title:'<span data-i18n="tbl.col.title.issue.Status"></span>',data:"labels","class":"issues labels-all",render:function(e){var t=_.filter(e,function(e){return app.conf.issueStatusLabels.containsStrIgnoreCase(e)});return app.gitLabIssues.toLabelTags(t).join("<br/>")}},{width:"100",title:'<span data-i18n="tbl.col.title.issue.assignTo"></span>',render:function(e,t,s){var a=s.assignee||{name:"None",username:"-"};return'<span title="author: '+s.author.name+'">'+(a.name||"None")+" ["+(a.username||"-")+"]"+"</span>"}},{width:"100",title:'<span data-i18n="tbl.col.title.issue.updateDt"></span>',data:"updated_at",render:function(e){return'<span title="UTC: '+e+'">'+app.uiHelper.utcToLocal(e)+"</span>"}},{width:"100",title:'<span data-i18n="tbl.col.title.issue.createdBy"></span>',data:"author",render:function(e,t,s){var a=e||{name:"None",username:"-"};return'<span title="at: '+app.uiHelper.utcToLocal(s.created_at)+'">'+(a.name||"None")+" ["+(a.username||"-")+"]"+"</span>"}},{width:"100",title:'<span data-i18n="tbl.col.title.issue.milestone"></span>',data:"milestone",render:function(e){return spa.findSafe(e,"title","-")}},{width:"50",title:'<span data-i18n="tbl.col.title.issue.priority"></span>',data:"labels","class":"issues labels-all",render:function(e){var t=_.filter(e,function(e){return app.conf.issuePriorityLabels.containsStrIgnoreCase(e)});return app.gitLabIssues.toLabelTags(t).join("<br/>")}},{title:'<span data-i18n="tbl.col.title.issue.title"></span><br/><span data-i18n="tbl.col.title.issue.labels"></span>',data:"title",render:function(e,t,s){var a=app.gitLabIssues.toLabelTags(s.labels);return"#"+s.iid+"("+s.state+"): <b>"+e+"</b><sup data-i18n=\"title:'tbl.col.title.issue.notes'\"> "+s.user_notes_count+"</sup>"+'<br/><div class="issues labels-all">'+a.join(" ")+"</div>"}},{title:"",data:"updated_at"}],drawCallback:function(){app.gitLabIssues.controlActionButtons(e),dt.columnsAdjustNow()},initComplete:function(){$("#container_gitLabIssues").removeClass("hide"),app.gitLabIssues.updateSeverityCounts(),dt.customize(e),app.uiHelper.indicateLoading("#btnIssuesFullRefresh, #btnIssuesFullRefreshLink","remove"),app.gitLabIssues.list(!0)}})},controlActionButtons:function(e){if(dt.updateCheckAllNoneChecboxStatus(e),app.gitLabIssues.controlActionButtonsEnabled){var t=e+"_wrapper",s=$(t),a=s.find("tbody tr.selected"),i=a.length,n=i>0,o=dt.selectedRowData(e),r=s.find("tbody td.VIEW-COL"),l="Closed";if(r.addClass("disabled"),s.closest(".container-component").find("button.ACTION").addClass("hide"),n)if(s.find("tbody :checkbox:checked").length?r.addClass("disabled"):r.removeClass("disabled"),1===i)s.closest(".container-component").find("button.ACTION."+o.Status.toUpperCase()).removeClass("hide");else{var u=s.find("tr.selected td.ISSUE-STATUS").map(function(e,t){return t.innerHTML}),p=u[0],c=_.every(u,function(e){return e.equalsIgnoreCase(p)});c?s.closest(".container-component").find("button.ACTION."+p.toUpperCase()).removeClass("hide"):0>_.indexOf(u,l)&&s.closest(".container-component").find("button.ACTION.-"+l.toUpperCase()).removeClass("hide")}else r.removeClass("disabled")}},showViewPane:function(){var e=$("#container_gitLabIssues"),t=$("#btnLayoutChange i");t.hasClass(app.gitLabIssues.toListLayoutIcon)||(t.toggleClass("columns").toggleClass(app.gitLabIssues.toListLayoutIcon),e.toggleClass("max"),dt.columnsAdjustNow())},toggleLayout:function(){var e=$("#container_gitLabIssues"),t=$("#btnLayoutChange i");if(t.toggleClass("columns").toggleClass(app.gitLabIssues.toListLayoutIcon),e.toggleClass("max"),dt.columnsAdjustNow(),t.hasClass(app.gitLabIssues.toListLayoutIcon)){var s,a=dt.selectedRow(app.gitLabIssues.tableSelector);a&&(s=$(a).data("rowId")),app.gitLabIssues.showDetails(s)}},showDetails:function(e){"use strict";var t=$("#container_gitLabIssues"),s=$("#btnLayoutChange i");if(t.find("#gitLabIssue"),s.hasClass(app.gitLabIssues.toListLayoutIcon)){var a=dt.selectedRowDataByRowId(app.gitLabIssues.tableSelector,e);if(!spa.isBlank(a)){a.rowId=e,a.description=app.uiHelper.updateGitLabImageSrc(a.description);var i={data:a},n=dt.tables[dt.tableKey(app.gitLabIssues.tableSelector)],o=n?n.rows({selected:!0})[0].length:0;if(o>1){var r=$(":checkbox.ISSUE-CHECK:checked").length;r||n.rows(":not([data-issue-id="+a.id+"])").deselect()}app.uiHelper.indicateLoading("#btnIssueFullRefresh","add"),app.gitLabIssues.inViewIssueId=a.id,spa.renderComponent("gitLabIssue",i)}}},updateIssueDetailsInRowData:function(e){var t=e.id||"";if(t){var s=dt.tables[dt.tableKey(app.gitLabIssues.tableSelector)].row("[data-issue-id="+t+"]");if(!spa.isBlank(s)){var a=s.data(),i=_.merge(a,e);spa.isBlank(e.labels)&&(i.labels=[]),s.data(i),app.gitLabIssue.data=i;var n=dt.getRowBySelector("#gitLabIssues","[data-issue-id="+t+"]");spa.isBlank(n)||n.data("rowData",i)}}},selectedIssueIDs:function(){"use strict";var e=app.gitLabIssues.tableSelector,t=spa.serialize(e+"_wrapper","ISSUE-CHECK").selectedIssuesList;return spa.isBlank(t)?t=[""+dt.selectedRowData(e).iid]:"string"==typeof t&&(t=[t]),t},updateSeverityCounts:function(){var e=$("#container_gitLabIssues");e.find("#btn_Severity_CRITICAL .count").html(app.gitLabIssues.cCount),e.find("#btn_Severity_WARNING .count").html(app.gitLabIssues.wCount)},filterByMine:function(){var e=app.activeGitLab.uName||app.user.storeName||"";app.gitLabIssues.filterByCol(5,e)},filterByAssignToMe:function(){var e=app.activeGitLab.uName||app.user.storeName||"";app.gitLabIssues.filterByCol(3,e)},filterByCol:function(e,t,s){s||dt.clearActiveTableSearch();var a=$(".dataTables_wrapper:visible [data-column-index="+e+"]").find("input[type=search]");if(a.length){var i=s?a.val():"";a.val(i+t).trigger("keyup")}},showHideQuickFilter:function(e){var t=$("#container_gitLabIssues").find(".grid-filters-buttons");e?t.removeClass("hide"):t.addClass("hide")},quickFilter:function(e,t){"use strict";$(e).toggleClass("active"),$(t).removeClass("active");var s=_.map($("#container_gitLabIssues .grid-filters-buttons button.active"),function(e){return $(e).data("filter")}).join("").getRightStr("Severity_");if(dt.clearActiveTableSearch(),s){var a=app.conf.issueLabelsGrp[s];app.gitLabIssues.filterByCol(1,a)}},clearQuickFilter:function(){$("#container_gitLabIssues .grid-filters-buttons button.active").removeClass("active")},openNewIssue:function(){app.uiHelper.openInNewTab(app.activeGitLab.web+"/issues/new")},action:function(e){"use strict";var t=_.map(dt.selectedRowsData(app.gitLabIssues.tableSelector,["LogMessageId"]),function(e){return e.LogMessageId}),s={LogMessageIds:t.join(",")};spa.api.put(spa.api.url("@gitLabIssueDetails",{type:e}),s,function(){dt.reloadDatatable(app.gitLabIssues.tableSelector),app.uiHelper.flyout("success","common.msg.success",{op:"Issue has been."})})}});