var dt={tables:{},options:{}};dt.tableKey=function(t){return t.replace(/#|_wrapper/g,"")},dt.tableId=function(t){return"#"+dt.tableKey(t)},dt.tableWrapperId=function(t){return dt.tableId(t)+"_wrapper"},dt.registerExport=function(t){var e=dt.tableKey(t),a=dt.tableId(t),n=$(a).closest(".container-component").find(".dt-export"),s=n.find("[data-export]"),d=dt.tables[e].data().length;spa.console.log(spa.now()+">Initializing Client-side Export button for talbeId "+a),n.length?(s.length||(s=n.filter("[data-export]")),n.addClass("hide"),s.off("click"),d&&(spa.console.log(spa.now()+">Registering Table Export Rows:"+d),n.removeClass("hide"),s.on("click",function(){dt.exportData(a,$(this).data("export"))}))):spa.console.log(spa.now()+">Export button.dt-export not found in container-component.")},dt.updateRowSelection=function(t){var e=dt.tables[dt.tableKey(t)],a=$(dt.tableWrapperId(t)).find("tbody tr.selected"),n=_.map(a,function(t){return $(t).data("rowId")}),s=$(dt.tableWrapperId(t)).find("tbody tr:not(.selected)"),d=_.map(s,function(t){return $(t).data("rowId")});e.rows(d).deselect(),e.rows(n).select(!0)},dt.customize=function(t){"use strict";var e=dt.tableKey(t),a=dt.tableId(t),n=dt.tableWrapperId(a),s=$(a).DataTable(),d=$(n),i=d.find(".dataTables_length"),l=d.find(".dataTables_info"),o=d.find(".dataTables_paginate"),r=d.find(".dataTables_filter"),c=r.find(":input[type=search]"),u="table-footer",p='<input type="button" data-i18n="title:\'dtLang.clearBtnTitle\',value:\'dtLang.clearBtnLbl\'" class="ui button primary CLEAR" data-table-key="'+e+'">'+'<input type="button" data-i18n="title:\'dtLang.AdvSearchBtnTitle\',value:\'dtLang.AdvSearchBtnLbl\'" class="ui button primary advanced-filter-button">';spa.console.log("DataTable:["+e+"] initialized."+spa.now()),dt.tables[e]=s,d.find("h1").insertAfter("ul"),d.find(".dataTables_filter").css("float","left"),d.find(".dataTables_paginate").css("float","left"),d.find(".dataTables_filter").wrap("<div class='table-filter clearfix'></div>"),d.find(".dataTables_filter label").contents().first().remove(),d.find(".dataTables_length label").contents().first().remove(),d.find(".dataTables_length label").contents().last().remove(),d.find(".dataTables_length select").i18n("title:'dtLang.sInfo.noOfRows'"),i.insertBefore(l),i.find("select").addClass("input-sm"),d.find(".ColVis_Button").i18n("title:'dtLang.showHideCols'").html('<i class="stl-icons filter"></i>'),$('<div class="dt-filter FILTER-WRAP"><label data-i18n="dtLang.SearchLbl"></label></div>').insertBefore(r),$(p).insertAfter(d.find(".dataTables_filter label")),$('<div class="advanced-search-wrap"></div>').insertAfter(d.find(".table-filter")),d.children(".dataTables_info").before('<div class="'+u+'"></div>'),d.children(a+"_info").appendTo(n+" ."+u+""),d.children(a+"_paginate").appendTo(n+" ."+u+""),$('<span class="reload" data-i18n="title:\'dtLang.refresh\'"><button class="ui button icon RELOAD-BUTTON" data-table-id="'+e+'" disabled><i class="icon repeat loading"></button></span>').insertAfter(o),$(n+" .dataTables_info").appendTo(n+" ."+u+""),d.find(".advanced-filter-button").on("click",function(){var t=$(this),e=$(n+" .dataTables_scrollBody").height();d.find(".dataTables_scrollFoot").slideToggle(),d.find(".advanced-search-wrap").toggle(),$(".advanced-search-wrap").is(":visible")?$(".dataTables_scrollBody").height(e-38):$(".dataTables_scrollBody").height(e+38),t.toggleClass("active");var a=t.hasClass("active"),s=a?"value:'dtLang.closeAdvSearchBtnLbl',title:'dtLang.closeAdvSearchBtnTitle'":"value:'dtLang.AdvSearchBtnLbl',title:'dtLang.AdvSearchBtnTitle'",i=spa.i18n.text(a?"dtLang.closeAdvSearchBtnLbl":"dtLang.AdvSearchBtnLbl"),l=spa.i18n.text(a?"dtLang.closeAdvSearchBtnTitle":"dtLang.AdvSearchBtnTitle");t.attr({"data-i18n":s,value:i,title:l})}),dt.columnsAdjust(),$(c).on("keyup",function(){s.search((this.value+"").replace(/,/g,"|"),!0,!1).draw()}),dt.initAdvSearch(a),d.closest(".container-component").find("button.ACTION").addClass("hide"),dt.registerExport(a),spa.i18n.apply(n),d.find(".ColVis_Button").on("click",function(){spa.i18n.apply(".ColVis_collection")}),$('[data-table-id="'+e+'"]').prop("disabled",!1).find("i.icon").removeClass("loading")},dt.defaultOptions={scrollX:!0,scrollCollapse:!1,paging:!0,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pagingType:"full_numbers",fixedColumns:!1,bDestroy:!0,dom:'C<"clear">Zlfrtip',colReorder:{fixedColumnsRight:1}},dt.DataTable=function(t,e){"use strict";dt.options[dt.tableKey(t)]=e,e.columns.push({width:"1",title:"",render:function(){return""}}),dt.initAdvSearchCols(t);var a={oLanguage:app.settings.dtLang(),initComplete:function(){dt.customize(t)}};$(t).DataTable(_.merge(a,dt.defaultOptions,e))},dt.initAdvSearchCols=function(t){"use strict";var e,a,n=dt.tableKey(t),s=dt.tableId(t),d=$(s),i=dt.options[n],l=i.columns;d.find("tfoot").length||d.append("<tfoot></tfoot>"),d.find("tfoot").html("<tr></tr>"),e=d.find("tfoot tr"),_.each(l,function(t){a=t.title.beginsWithStrIgnoreCase("<span")?!t.hasOwnProperty("advSearch")||spa.toBoolean(""+t.advSearch)?"":"soft-hide":"soft-hide",e.append("<th class="+a+">&nbsp;</th>")})},dt.initAdvSearch=function(t){"use strict";var e=dt.tableKey(t),a=dt.tableWrapperId(t),n=$(a),s=dt.tables[e],d=dt.options[e];(spa.isBlank(d)||d&&(!d.hasOwnProperty("advSearch")||spa.toBoolean(""+d.advSearch)))&&(n.find(".dataTables_scrollFoot tfoot th").each(function(t,e){$(e).attr("data-column-index",t).html('<input type="search" data-i18n="placeholder:\'dtLang.AdvSearchFldTxt\'" />')}),s.columns().every(function(){var t=this;$("input[type=search]",this.footer()).on("keyup change",function(){t.search()!==this.value&&t.search((this.value+"").replace(/,/g,"|"),!0,!1).draw()})}))},dt.selectRowByIndex=function(t,e){"use strict";$(t+"_wrapper").find("tbody tr:nth-child("+e+")").trigger("click")},dt.selectRowById=function(t,e){"use strict";$(t+"_wrapper").find("tbody tr[data-row-id="+e+"]").trigger("click")},dt.getRowById=function(t,e){"use strict";return $(t+"_wrapper").find("tbody tr[data-row-id="+e+"]")},dt.selectAllNone=function(t,e){$(t+" tbody").find(":checkbox").prop("checked",e.checked),e.checked?$(t+" tbody").find("tr").addClass("selected"):$(t+" tbody").find("tr").removeClass("selected"),dt.updateRowSelection(t)},dt.updateCheckAllNoneChecboxStatus=function(t){var e=t+"_wrapper",a=$(e+" tbody").find("tr").length,n=$(e+" tbody").find(":checkbox:checked").closest("tr").length,s=a===n,d=$(e).find(":checkbox.CHECK-ALL-NONE");d.prop("checked",s)},dt.selectRow=function(t,e){"use strict";$(t+"_wrapper").find("tbody tr:nth-child("+e+")").trigger("click")},dt.selectedRows=function(t){"use strict";return $(t+"_wrapper").find("tbody tr.selected")},dt.selectedRow=function(t){"use strict";var e,a=dt.selectedRows(t);return a.length&&(e=a.get(0)),e},dt.selectedRowIds=function(t){"use strict";return _.map(dt.selectedRows(t),function(t){return $(t).data("rowId")})},dt.selectedRowData=function(t){"use strict";var e={},a=dt.selectedRows(t);return a.length&&(e=1===a.length?a.data("rowData"):dt.selectedRowsData(t)),e},dt.selectedRowDataByRowId=function(t,e){"use strict";return $(t+"_wrapper").find("tbody tr[data-row-id="+e+"]").data("rowData")},dt.selectedRowsData=function(t,e){"use strict";var a=[],n=dt.selectedRows(t);return n.length&&(_.each(n,function(t){a.push($(t).data("rowData"))}),spa.isBlank(e)||(a=_.map(a,function(t){return _.pick(t,e)}))),a},dt.resizeTableHeight=function(){"use strict";var t=$("#mainContent").height()-247;$("#mainContent .content.dtresize .dataTables_scrollBody").height(t)},dt.columnsAdjustNow=function(){"use strict";$($.fn.dataTable.tables(!0)).DataTable().columns.adjust()},dt.columnsAdjust=function(){"use strict";dt.columnsAdjustNow();var t=$("#containerMain").hasClass("max")?320:0,e=0,a=0,n=$(".dataTable:visible").closest(".container-component");n.length&&n[0].hasOwnProperty("clientWidth")&&(e=n[0].clientWidth-(19+t),a=$(".dataTable").width(),e>a&&setTimeout(function(){dt.columnsAdjust()},550))},dt.clearActiveTableSearch=function(){$(".dataTables_wrapper:visible").find("input[type=search]").val("").trigger("keyup")},$(document).on("click",".events-filter-button",function(){"use strict";setTimeout(function(){dt.columnsAdjust()},610)}),$(document).on("change",".dataTables_length select",function(){"use strict";dt.columnsAdjust()}),$(document).on("click",".dataTables_filter input.CLEAR",function(){"use strict";var t=$(this);t.closest(".dataTables_wrapper").find("input[type=search]").val("").trigger("keyup"),app.gitLabIssues&&app.gitLabIssues.clearQuickFilter(),dt.reloadDatatable(),$(".CHECK-ALL-NONE, .ISSUE-CHECK").each(function(t,e){e.checked=!1})}),$(document).on("click",".RELOAD-BUTTON",function(){"use strict";dt.reloadDatatable(!0)}),dt.reloadDatatable=function(t){"use strict";app.gitLabIssues.list(t)},dt.settings=function(t,e){"use strict";var a=dt.tableKey(t),n=dt.tables.hasOwnProperty(a),s=n?dt.tables[a].settings()[0].oInit:{},d=s;return spa.isBlank(e)||(d="string"==typeof e?s[e]:_.pick(s,e)),d},dt.exportData=function(t,e){"use strict";var a=dt.tableKey(t),n=dt.tables.hasOwnProperty(a),s="all".equalsIgnoreCase(e),d=dt.tables[a].rows({selected:!0}),i=$(dt.tableWrapperId(t)).find("thead :checkbox.CHECK-ALL-NONE").length,l=n?s||!i?dt.tables[a].data():d.data():[],o="",r=new Date,c=r.yyyymmdd()+r.hhmmss(),u=a.replace(/table/gi,"")+"-"+c+".csv",p=n?dt.tables[a].settings()[0].oInit["export"]||{}:{},f={},b=!1,h=_.keys(p),g=_.filter(h,function(t){return t.beginsWithStr("_")}),v="";n?spa.isBlank(p)?spa.console.log("Missing export settings in table:"+a):(spa.console.log(l),l.length?(o='"'+_.map(p,function(t){return t}).join('","')+'"',f=dt.tables[a].settings()[0].oInit.exportFormat||{},b=!spa.isBlank(f),_.each(l,function(t){var e=_.merge({},_.pick(t,h));spa.isBlank(g)||_.each(g,function(t){e[t]=""}),spa.console.log(e),b&&_.each(_.keys(f),function(a){e[a]=""+f[a](e[a],t)}),spa.console.log(e),v='\n"'+_.map(e,function(t){return t}).join('","')+'"',o+=v}),spa.console.log(u+">>"+o),saveAs(new Blob([o],{type:"text/plain;charset=utf-8"}),u)):(app.uiHelper.showAlert("warning","tbl.no.row.selected.eventsExport"),spa.console.log("NO DATA in table:"+a))):spa.console.log("data table:"+a+" NOT LOADED.")};